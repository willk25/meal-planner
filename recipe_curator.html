<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Recipe Curator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --bg-dark: #1a1a1a;
            --bg-card: #242424;
            --bg-hover: #2d2d2d;
            --accent: #e07b39;
            --accent-light: #f4a261;
            --text: #f5f5f5;
            --text-muted: #a0a0a0;
            --border: #333;
            --success: #4ade80;
            --family: #a78bfa;
        }
        
        body {
            font-family: 'Source Sans 3', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
        }
        
        html {
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        header {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-bottom: 1px solid var(--border);
            padding: 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--accent-light);
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            font-weight: 300;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1.5rem;
            align-items: center;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .search-box::before {
            content: "üîç";
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9rem;
        }
        
        select {
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.95rem;
            font-family: inherit;
            cursor: pointer;
            min-width: 150px;
        }
        
        select:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .stats {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .stat {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-light);
        }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--accent);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--accent-light);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }
        
        .btn-outline:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
        }
        
        .btn-success {
            background: var(--success);
            color: #1a1a1a;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
        }
        
        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
            -webkit-overflow-scrolling: touch;
        }
        
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.25rem;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (max-width: 768px) {
            .recipe-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            main {
                padding: 1rem;
                padding-bottom: 120px;
            }
            
            header {
                padding: 1rem;
            }
            
            .quick-actions {
                padding: 1rem;
                flex-wrap: wrap;
            }
            
            .quick-actions .btn {
                font-size: 0.85rem;
                padding: 0.6rem 1rem;
            }
        }
        
        .recipe-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }
        
        .recipe-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        
        .recipe-card.selected {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1) 0%, var(--bg-card) 100%);
        }
        
        .recipe-card.family {
            border-left: 3px solid var(--family);
        }
        
        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .recipe-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            font-weight: 600;
            line-height: 1.3;
            flex: 1;
        }
        
        .recipe-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
            background: var(--bg-dark);
        }
        
        .recipe-card.selected .recipe-checkbox {
            background: var(--success);
            border-color: var(--success);
        }
        
        .recipe-checkbox::after {
            content: "‚úì";
            color: #1a1a1a;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .recipe-card.selected .recipe-checkbox::after {
            opacity: 1;
        }
        
        .recipe-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .tag {
            padding: 0.25rem 0.6rem;
            background: var(--bg-dark);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .tag.protein { color: #f87171; }
        .tag.meal { color: #60a5fa; }
        .tag.difficulty { color: #fbbf24; }
        .tag.family { background: var(--family); color: #1a1a1a; }
        
        .recipe-stats {
            display: flex;
            gap: 1rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .recipe-stats span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .recipe-details {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        
        .recipe-card.expanded .recipe-details {
            display: block;
        }
        
        .recipe-details h4 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-light);
            margin: 0.75rem 0 0.5rem 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .recipe-details h4:first-child {
            margin-top: 0;
        }
        
        .recipe-details ul {
            list-style: none;
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        .recipe-details li {
            padding: 0.2rem 0;
            padding-left: 1rem;
            position: relative;
        }
        
        .recipe-details li::before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: var(--accent);
        }
        
        .recipe-details ol {
            list-style: none;
            counter-reset: step;
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        .recipe-details ol li {
            counter-increment: step;
            padding-left: 1.5rem;
        }
        
        .recipe-details ol li::before {
            content: counter(step) ".";
            position: absolute;
            left: 0;
            color: var(--accent);
            font-weight: 600;
        }
        
        .expand-btn {
            margin-top: 0.75rem;
            width: 100%;
            padding: 0.5rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .expand-btn:hover {
            border-color: var(--accent);
            color: var(--text);
        }
        
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem;
            color: var(--text-muted);
        }
        
        .no-results h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        /* Modal for export */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-content h2 {
            font-family: 'Playfair Display', serif;
            color: var(--accent-light);
            margin-bottom: 1rem;
        }
        
        .modal-content textarea {
            width: 100%;
            height: 300px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            color: var(--text);
            font-family: monospace;
            font-size: 0.85rem;
            resize: vertical;
        }
        
        .modal-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: flex-end;
        }
        
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--success);
            color: #1a1a1a;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 300;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* Quick action bar */
        .quick-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, transparent 0%, var(--bg-dark) 30%);
            padding: 2rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
            z-index: 50;
            pointer-events: none;
        }
        
        .quick-actions .btn {
            pointer-events: auto;
        }
        
        .quick-actions .btn {
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        
        main {
            padding-bottom: 100px;
        }
        
        /* Import recipe modal tabs */
        .import-tab-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--text-muted);
            font-size: 0.95rem;
            font-family: inherit;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .import-tab-btn:hover {
            color: var(--text);
        }
        
        .import-tab-btn.active {
            color: var(--accent-light);
            border-bottom-color: var(--accent-light);
        }
        
        .import-tab-content {
            animation: fadeIn 0.2s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <header>
        <h1>üçΩÔ∏è Recipe Curator</h1>
        <p class="subtitle">Browse, select, and export your favorite recipes</p>
        
        <div class="controls">
            <div class="search-box">
                <input type="text" id="search" placeholder="Search recipes...">
            </div>
            
            <select id="filterProtein">
                <option value="">All Proteins</option>
                <option value="chicken">üêî Chicken</option>
                <option value="beef">ü•© Beef</option>
                <option value="pork">üê∑ Pork</option>
                <option value="seafood">üêü Seafood</option>
                <option value="turkey">ü¶É Turkey</option>
                <option value="lamb">üêë Lamb</option>
                <option value="eggs">ü•ö Eggs</option>
                <option value="other">ü•ó Other/Veggie</option>
            </select>
            
            <select id="filterMeal">
                <option value="">All Meal Types</option>
                <option value="breakfast">üåÖ Breakfast</option>
                <option value="entree">üçΩÔ∏è Entree</option>
                <option value="soup">ü•£ Soup</option>
                <option value="salad">ü•ó Salad</option>
                <option value="appetizer">üç§ Appetizer</option>
                <option value="dessert">üç∞ Dessert</option>
            </select>
            
            <select id="filterDifficulty">
                <option value="">All Difficulties</option>
                <option value="easy">‚ö° Easy</option>
                <option value="medium">‚è±Ô∏è Medium</option>
                <option value="involved">üë®‚Äçüç≥ Involved</option>
            </select>
            
            <select id="filterFamily">
                <option value="">All Recipes</option>
                <option value="family">üè† Family Only</option>
                <option value="curated">üìö Curated Only</option>
            </select>
            
            <select id="sortBy">
                <option value="title">Sort: A-Z</option>
                <option value="rating">Sort: Rating</option>
                <option value="protein">Sort: Protein</option>
                <option value="ingredients">Sort: Simplest First</option>
            </select>
        </div>
        
        <div class="stats">
            <div class="stat">
                <span class="stat-value" id="totalCount">0</span>
                <span class="stat-label">total recipes</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="showingCount">0</span>
                <span class="stat-label">showing</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="selectedCount">0</span>
                <span class="stat-label">selected</span>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showImportRecipeModal()" style="background: #60a5fa;">üì• Import Recipe</button>
                <button class="btn btn-primary" onclick="showAddRecipeModal()" style="background: var(--accent-light);">üì∏ Add Recipe from Photo</button>
                <button class="btn btn-outline" onclick="selectAll()">Select All Visible</button>
                <button class="btn btn-outline" onclick="clearSelection()">Clear Selection</button>
                <button class="btn btn-primary" onclick="showExport()">Export Selected</button>
            </div>
        </div>
    </header>
    
    <main>
        <div class="recipe-grid" id="recipeGrid">
            <!-- Recipes will be inserted here -->
        </div>
    </main>
    
    <div class="quick-actions">
        <button class="btn btn-primary" onclick="showImportRecipeModal()" style="background: #60a5fa;">
            üì• Import Recipe
        </button>
        <button class="btn btn-primary" onclick="showAddRecipeModal()" style="background: var(--accent-light);">
            üì∏ Add Recipe from Photo
        </button>
        <button class="btn btn-success" onclick="showExport()">
            üì• Export <span id="exportCount">0</span> Selected Recipes
        </button>
    </div>
    
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <h2>Export Selected Recipes</h2>
            <p style="margin-bottom: 1rem; color: var(--text-muted);">
                Copy this JSON and save it as your new curated_recipes.json
            </p>
            <textarea id="exportData" readonly></textarea>
            <div class="modal-buttons">
                <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="copyExport()">Copy to Clipboard</button>
                <button class="btn btn-success" onclick="downloadExport()">Download JSON</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="importRecipeModal">
        <div class="modal-content" style="max-width: 800px;">
            <h2>üì• Import Recipe</h2>
            <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border);">
                <button type="button" class="import-tab-btn active" onclick="switchImportTab('text')" id="importTabText">
                    üìã Paste Recipe Text
                </button>
                <button type="button" class="import-tab-btn" onclick="switchImportTab('url')" id="importTabUrl">
                    üîó Paste URL
                </button>
            </div>
            
            <!-- Text Paste Tab -->
            <div id="importTextTab" class="import-tab-content">
                <form id="importTextForm" onsubmit="importFromText(event)">
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                            Paste Recipe Text *
                        </label>
                        <textarea id="pastedRecipeText" rows="15" required
                                  style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.9rem; font-family: inherit; resize: vertical;"
                                  placeholder="Paste your recipe here...&#10;&#10;Example:&#10;Chicken Parmesan&#10;&#10;Ingredients:&#10;2 chicken breasts&#10;1 cup breadcrumbs&#10;1/2 cup parmesan cheese&#10;&#10;Directions:&#10;1. Preheat oven to 375¬∞F&#10;2. Coat chicken in breadcrumbs&#10;3. Bake for 25 minutes"></textarea>
                        <p style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.85rem;">
                            The recipe will be automatically parsed. Make sure to include a title, ingredients, and directions.
                        </p>
                    </div>
                    <div class="modal-buttons">
                        <button type="button" class="btn btn-outline" onclick="closeImportRecipeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Parse & Import Recipe</button>
                    </div>
                </form>
            </div>
            
            <!-- URL Tab -->
            <div id="importUrlTab" class="import-tab-content" style="display: none;">
                <form id="importUrlForm" onsubmit="importFromUrl(event)">
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                            Recipe URL *
                        </label>
                        <input type="url" id="recipeUrl" required
                               style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 1rem;"
                               placeholder="https://www.allrecipes.com/recipe/...">
                        <p style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.85rem;">
                            Paste a URL from a recipe website. The recipe will be automatically extracted.
                        </p>
                    </div>
                    <div id="urlLoading" style="display: none; text-align: center; padding: 2rem; color: var(--text-muted);">
                        <p>‚è≥ Extracting recipe from URL...</p>
                    </div>
                    <div id="urlPreview" style="display: none; margin-bottom: 1rem; padding: 1rem; background: var(--bg-dark); border-radius: 8px; border: 1px solid var(--border);">
                        <h3 style="color: var(--accent-light); margin-bottom: 0.5rem;" id="urlPreviewTitle"></h3>
                        <p style="color: var(--text-muted); font-size: 0.9rem;" id="urlPreviewInfo"></p>
                    </div>
                    <div class="modal-buttons">
                        <button type="button" class="btn btn-outline" onclick="closeImportRecipeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="urlImportBtn">Extract & Import Recipe</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="modal" id="addRecipeModal">
        <div class="modal-content" style="max-width: 700px;">
            <h2>üì∏ Add Recipe from Photo</h2>
            <form id="addRecipeForm" onsubmit="saveRecipeFromPhoto(event)">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                        Recipe Photo
                    </label>
                    <div style="position: relative;">
                        <input type="file" id="recipePhoto" accept="image/*" capture="environment" 
                               style="display: none;" onchange="handlePhotoSelect(event)">
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" class="btn btn-outline" onclick="document.getElementById('recipePhoto').click()" style="flex: 1;">
                                üì∑ Choose Photo
                            </button>
                            <button type="button" class="btn btn-outline" onclick="capturePhoto()" style="flex: 1;">
                                üì∏ Take Photo
                            </button>
                        </div>
                        <div id="photoPreview" style="margin-top: 1rem; display: none;">
                            <img id="previewImage" style="max-width: 100%; max-height: 300px; border-radius: 8px; border: 1px solid var(--border);">
                            <button type="button" class="btn btn-outline" onclick="clearPhoto()" style="margin-top: 0.5rem; width: 100%;">
                                Remove Photo
                            </button>
                        </div>
                        <video id="cameraVideo" style="display: none; width: 100%; max-height: 300px; border-radius: 8px; border: 1px solid var(--border);"></video>
                        <canvas id="cameraCanvas" style="display: none;"></canvas>
                        <div id="cameraControls" style="display: none; margin-top: 0.5rem; text-align: center;">
                            <button type="button" class="btn btn-primary" onclick="captureFromCamera()">üì∏ Capture</button>
                            <button type="button" class="btn btn-outline" onclick="stopCamera()">Cancel</button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                        Recipe Title *
                    </label>
                    <input type="text" id="recipeTitle" required
                           style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 1rem;">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                            Protein Source
                        </label>
                        <select id="recipeProtein" style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                            <option value="">Select...</option>
                            <option value="chicken">Chicken</option>
                            <option value="beef">Beef</option>
                            <option value="pork">Pork</option>
                            <option value="seafood">Seafood</option>
                            <option value="turkey">Turkey</option>
                            <option value="lamb">Lamb</option>
                            <option value="eggs">Eggs</option>
                            <option value="other">Other/Veggie</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                            Meal Type
                        </label>
                        <select id="recipeMealType" style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                            <option value="entree">Entree</option>
                            <option value="breakfast">Breakfast</option>
                            <option value="soup">Soup</option>
                            <option value="salad">Salad</option>
                            <option value="appetizer">Appetizer</option>
                            <option value="dessert">Dessert</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                        Ingredients (one per line)
                    </label>
                    <textarea id="recipeIngredients" rows="5"
                              style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.9rem; font-family: inherit; resize: vertical;"
                              placeholder="1 cup flour&#10;2 eggs&#10;1 tsp salt"></textarea>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                        Directions (one per line)
                    </label>
                    <textarea id="recipeDirections" rows="5"
                              style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.9rem; font-family: inherit; resize: vertical;"
                              placeholder="Mix ingredients together&#10;Cook for 30 minutes"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                            Rating (0-5)
                        </label>
                        <input type="number" id="recipeRating" min="0" max="5" step="0.1"
                               style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                            Protein (g)
                        </label>
                        <input type="number" id="recipeProteinGrams" min="0"
                               style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500;">
                            Difficulty
                        </label>
                        <select id="recipeDifficulty" style="width: 100%; padding: 0.75rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="involved">Involved</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="btn btn-outline" onclick="closeAddRecipeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Recipe</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="toast" id="toast">Copied to clipboard!</div>
    
    <script>
        let recipes = [];
        let selectedIds = new Set();
        
        // Load recipes from the JSON file
        async function loadRecipes() {
            try {
                const response = await fetch('curated_recipes.json');
                recipes = await response.json();
                
                // Add IDs to recipes if they don't have them
                recipes.forEach((r, i) => {
                    if (!r.id) r.id = i;
                });
                
                document.getElementById('totalCount').textContent = recipes.length;
                renderRecipes();
            } catch (error) {
                console.error('Error loading recipes:', error);
                document.getElementById('recipeGrid').innerHTML = `
                    <div class="no-results">
                        <h3>Could not load recipes</h3>
                        <p>Make sure curated_recipes.json is in the same directory.</p>
                        <p style="margin-top: 1rem; font-size: 0.85rem;">${error.message}</p>
                    </div>
                `;
            }
        }
        
        function getFilteredRecipes() {
            const search = document.getElementById('search').value.toLowerCase();
            const protein = document.getElementById('filterProtein').value;
            const meal = document.getElementById('filterMeal').value;
            const difficulty = document.getElementById('filterDifficulty').value;
            const family = document.getElementById('filterFamily').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let filtered = recipes.filter(r => {
                // Search
                if (search && !r.title?.toLowerCase().includes(search)) {
                    return false;
                }
                
                // Protein filter
                if (protein && r.protein_source !== protein) {
                    return false;
                }
                
                // Meal type filter
                if (meal && r.meal_type !== meal) {
                    return false;
                }
                
                // Difficulty filter
                if (difficulty && r.difficulty !== difficulty) {
                    return false;
                }
                
                // Family filter
                if (family === 'family' && !r.is_family_recipe) {
                    return false;
                }
                if (family === 'curated' && r.is_family_recipe) {
                    return false;
                }
                
                return true;
            });
            
            // Sort
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'rating':
                        return (b.rating || 0) - (a.rating || 0);
                    case 'protein':
                        return (b.protein || 0) - (a.protein || 0);
                    case 'ingredients':
                        return (a.num_ingredients || 99) - (b.num_ingredients || 99);
                    default:
                        return (a.title || '').localeCompare(b.title || '');
                }
            });
            
            return filtered;
        }
        
        function renderRecipes() {
            const filtered = getFilteredRecipes();
            const grid = document.getElementById('recipeGrid');
            
            document.getElementById('showingCount').textContent = filtered.length;
            document.getElementById('selectedCount').textContent = selectedIds.size;
            document.getElementById('exportCount').textContent = selectedIds.size;
            
            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="no-results">
                        <h3>No recipes found</h3>
                        <p>Try adjusting your filters or search term.</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = filtered.map(recipe => {
                const isSelected = selectedIds.has(recipe.id);
                const isFamily = recipe.is_family_recipe;
                
                return `
                    <div class="recipe-card ${isSelected ? 'selected' : ''} ${isFamily ? 'family' : ''}" 
                         data-id="${recipe.id}"
                         onclick="toggleSelect(${recipe.id}, event)">
                        ${recipe.photo ? `<div style="margin-bottom: 0.75rem; border-radius: 8px; overflow: hidden;"><img src="${recipe.photo}" style="width: 100%; height: 200px; object-fit: cover; display: block;"></div>` : ''}
                        <div class="recipe-header">
                            <span class="recipe-title">${escapeHtml(recipe.title || 'Untitled')}</span>
                            <div class="recipe-checkbox"></div>
                        </div>
                        
                        <div class="recipe-meta">
                            ${recipe.protein_source ? `<span class="tag protein">${recipe.protein_source}</span>` : ''}
                            ${recipe.meal_type ? `<span class="tag meal">${recipe.meal_type}</span>` : ''}
                            ${recipe.difficulty ? `<span class="tag difficulty">${recipe.difficulty}</span>` : ''}
                            ${isFamily ? '<span class="tag family">Family</span>' : ''}
                        </div>
                        
                        <div class="recipe-stats">
                            ${recipe.rating ? `<span>‚≠ê ${recipe.rating.toFixed(1)}</span>` : ''}
                            ${recipe.protein ? `<span>üí™ ${Math.round(recipe.protein)}g</span>` : ''}
                            ${recipe.num_ingredients ? `<span>ü•¨ ${recipe.num_ingredients} ing</span>` : ''}
                            ${recipe.num_steps ? `<span>üìã ${recipe.num_steps} steps</span>` : ''}
                            ${recipe.estimated_price ? `<span>üí∞ $${recipe.estimated_price.toFixed(2)}</span>` : ''}
                        </div>
                        
                        ${recipe.ingredients || recipe.directions ? `
                            <button class="expand-btn" onclick="toggleExpand(event, ${recipe.id})">
                                Show Details ‚ñº
                            </button>
                            <div class="recipe-details">
                                ${recipe.ingredients ? `
                                    <h4>Ingredients</h4>
                                    <ul>
                                        ${recipe.ingredients.slice(0, 10).map(i => `<li>${escapeHtml(i)}</li>`).join('')}
                                        ${recipe.ingredients.length > 10 ? `<li><em>...and ${recipe.ingredients.length - 10} more</em></li>` : ''}
                                    </ul>
                                ` : ''}
                                ${recipe.directions ? `
                                    <h4>Directions</h4>
                                    <ol>
                                        ${recipe.directions.slice(0, 5).map(d => `<li>${escapeHtml(d)}</li>`).join('')}
                                        ${recipe.directions.length > 5 ? `<li><em>...and ${recipe.directions.length - 5} more steps</em></li>` : ''}
                                    </ol>
                                ` : ''}
                                ${recipe.source ? `<p style="margin-top: 0.75rem; color: var(--text-muted); font-size: 0.85rem;">Source: ${escapeHtml(recipe.source)}</p>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function toggleSelect(id, event) {
            // Don't toggle if clicking the expand button
            if (event.target.classList.contains('expand-btn')) return;
            
            if (selectedIds.has(id)) {
                selectedIds.delete(id);
            } else {
                selectedIds.add(id);
            }
            
            const card = document.querySelector(`.recipe-card[data-id="${id}"]`);
            if (card) {
                card.classList.toggle('selected', selectedIds.has(id));
            }
            
            document.getElementById('selectedCount').textContent = selectedIds.size;
            document.getElementById('exportCount').textContent = selectedIds.size;
        }
        
        function toggleExpand(event, id) {
            event.stopPropagation();
            const card = document.querySelector(`.recipe-card[data-id="${id}"]`);
            const btn = card.querySelector('.expand-btn');
            card.classList.toggle('expanded');
            btn.textContent = card.classList.contains('expanded') ? 'Hide Details ‚ñ≤' : 'Show Details ‚ñº';
        }
        
        function selectAll() {
            const filtered = getFilteredRecipes();
            filtered.forEach(r => selectedIds.add(r.id));
            renderRecipes();
        }
        
        function clearSelection() {
            selectedIds.clear();
            renderRecipes();
        }
        
        function showExport() {
            const selected = recipes.filter(r => selectedIds.has(r.id));
            document.getElementById('exportData').value = JSON.stringify(selected, null, 2);
            document.getElementById('exportModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('exportModal').classList.remove('active');
        }
        
        function copyExport() {
            const textarea = document.getElementById('exportData');
            textarea.select();
            document.execCommand('copy');
            showToast('Copied to clipboard!');
        }
        
        function downloadExport() {
            const selected = recipes.filter(r => selectedIds.has(r.id));
            const blob = new Blob([JSON.stringify(selected, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my_recipes.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Downloaded my_recipes.json!');
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        // Photo upload functionality
        let currentPhotoData = null;
        let cameraStream = null;
        
        function showAddRecipeModal() {
            document.getElementById('addRecipeModal').classList.add('active');
            document.getElementById('addRecipeForm').reset();
            clearPhoto();
        }
        
        function closeAddRecipeModal() {
            document.getElementById('addRecipeModal').classList.remove('active');
            clearPhoto();
            stopCamera();
        }
        
        function handlePhotoSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    currentPhotoData = e.target.result;
                    document.getElementById('previewImage').src = currentPhotoData;
                    document.getElementById('photoPreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
        
        function clearPhoto() {
            currentPhotoData = null;
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('recipePhoto').value = '';
        }
        
        function capturePhoto() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(stream => {
                        cameraStream = stream;
                        const video = document.getElementById('cameraVideo');
                        video.srcObject = stream;
                        video.style.display = 'block';
                        document.getElementById('cameraControls').style.display = 'block';
                    })
                    .catch(err => {
                        console.error('Error accessing camera:', err);
                        showToast('Could not access camera. Please use file upload instead.');
                    });
            } else {
                showToast('Camera not supported. Please use file upload instead.');
            }
        }
        
        function captureFromCamera() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('cameraCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            currentPhotoData = canvas.toDataURL('image/jpeg', 0.8);
            document.getElementById('previewImage').src = currentPhotoData;
            document.getElementById('photoPreview').style.display = 'block';
            
            stopCamera();
        }
        
        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            document.getElementById('cameraVideo').style.display = 'none';
            document.getElementById('cameraControls').style.display = 'none';
        }
        
        function saveRecipeFromPhoto(event) {
            event.preventDefault();
            
            const title = document.getElementById('recipeTitle').value.trim();
            if (!title) {
                showToast('Please enter a recipe title');
                return;
            }
            
            const ingredientsText = document.getElementById('recipeIngredients').value.trim();
            const directionsText = document.getElementById('recipeDirections').value.trim();
            
            const newRecipe = {
                id: Date.now(),
                title: title,
                protein_source: document.getElementById('recipeProtein').value || null,
                meal_type: document.getElementById('recipeMealType').value || 'entree',
                difficulty: document.getElementById('recipeDifficulty').value || 'medium',
                ingredients: ingredientsText ? ingredientsText.split('\n').filter(i => i.trim()) : [],
                directions: directionsText ? directionsText.split('\n').filter(d => d.trim()) : [],
                rating: parseFloat(document.getElementById('recipeRating').value) || null,
                protein: parseFloat(document.getElementById('recipeProteinGrams').value) || null,
                num_ingredients: ingredientsText ? ingredientsText.split('\n').filter(i => i.trim()).length : 0,
                num_steps: directionsText ? directionsText.split('\n').filter(d => d.trim()).length : 0,
                is_family_recipe: false,
                photo: currentPhotoData || null,
                date: new Date().toISOString()
            };
            
            // Add to recipes array
            recipes.push(newRecipe);
            
            // Save to localStorage as backup
            try {
                localStorage.setItem('curated_recipes_backup', JSON.stringify(recipes));
            } catch (e) {
                console.warn('Could not save to localStorage:', e);
            }
            
            // Update display
            document.getElementById('totalCount').textContent = recipes.length;
            renderRecipes();
            
            // Close modal and show success
            closeAddRecipeModal();
            showToast('Recipe added! Don\'t forget to export to save permanently.');
            
            // Show download prompt
            setTimeout(() => {
                if (confirm('Recipe added! Would you like to download the updated curated_recipes.json file now?')) {
                    downloadAllRecipes();
                }
            }, 500);
        }
        
        function downloadAllRecipes() {
            const blob = new Blob([JSON.stringify(recipes, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'curated_recipes.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Downloaded curated_recipes.json!');
        }
        
        // Event listeners
        document.getElementById('search').addEventListener('input', renderRecipes);
        document.getElementById('filterProtein').addEventListener('change', renderRecipes);
        document.getElementById('filterMeal').addEventListener('change', renderRecipes);
        document.getElementById('filterDifficulty').addEventListener('change', renderRecipes);
        document.getElementById('filterFamily').addEventListener('change', renderRecipes);
        document.getElementById('sortBy').addEventListener('change', renderRecipes);
        
        // Close modal on outside click
        document.getElementById('exportModal').addEventListener('click', (e) => {
            if (e.target.id === 'exportModal') closeModal();
        });
        
        document.getElementById('addRecipeModal').addEventListener('click', (e) => {
            if (e.target.id === 'addRecipeModal') closeAddRecipeModal();
        });
        
        document.getElementById('importRecipeModal').addEventListener('click', (e) => {
            if (e.target.id === 'importRecipeModal') closeImportRecipeModal();
        });
        
        // Import recipe functionality
        function showImportRecipeModal() {
            document.getElementById('importRecipeModal').classList.add('active');
            switchImportTab('text');
        }
        
        function closeImportRecipeModal() {
            document.getElementById('importRecipeModal').classList.remove('active');
            document.getElementById('pastedRecipeText').value = '';
            document.getElementById('recipeUrl').value = '';
            document.getElementById('urlPreview').style.display = 'none';
            document.getElementById('urlLoading').style.display = 'none';
            const importBtn = document.getElementById('urlImportBtn');
            importBtn.disabled = false;
            importBtn.textContent = 'Extract & Import Recipe';
            importBtn.setAttribute('data-recipe-extracted', 'false');
            window.extractedRecipeData = null;
        }
        
        function switchImportTab(tab) {
            // Update tab buttons
            document.getElementById('importTabText').classList.toggle('active', tab === 'text');
            document.getElementById('importTabUrl').classList.toggle('active', tab === 'url');
            
            // Update tab content
            document.getElementById('importTextTab').style.display = tab === 'text' ? 'block' : 'none';
            document.getElementById('importUrlTab').style.display = tab === 'url' ? 'block' : 'none';
        }
        
        function parseRecipeText(text) {
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);
            
            let title = '';
            let ingredients = [];
            let directions = [];
            let currentSection = null;
            
            // Common section headers
            const ingredientHeaders = ['ingredients', 'ingredient', 'what you need'];
            const directionHeaders = ['directions', 'instructions', 'steps', 'method', 'how to make', 'preparation'];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].toLowerCase();
                
                // Check if this is a section header
                if (ingredientHeaders.some(h => line.includes(h))) {
                    currentSection = 'ingredients';
                    continue;
                }
                if (directionHeaders.some(h => line.includes(h))) {
                    currentSection = 'directions';
                    continue;
                }
                
                // First non-empty line is usually the title
                if (!title && lines[i] && !lines[i].match(/^\d+[\.\)]/) && !lines[i].match(/^[‚Ä¢\-\*]/)) {
                    title = lines[i];
                    continue;
                }
                
                // Parse based on current section
                if (currentSection === 'ingredients') {
                    // Remove common prefixes
                    let ingredient = lines[i].replace(/^[‚Ä¢\-\*\d+\.\)]\s*/, '').trim();
                    if (ingredient) ingredients.push(ingredient);
                } else if (currentSection === 'directions') {
                    // Remove common prefixes
                    let direction = lines[i].replace(/^\d+[\.\)]\s*/, '').replace(/^[‚Ä¢\-\*]\s*/, '').trim();
                    if (direction) directions.push(direction);
                } else {
                    // Try to auto-detect: lines with numbers or bullets are usually directions
                    // Lines with measurements (cups, tsp, etc.) are usually ingredients
                    if (lines[i].match(/\d+\s*(cup|tbsp|tsp|oz|lb|g|kg|ml|l|pound|ounce|gram|kilogram|liter|milliliter)/i)) {
                        ingredients.push(lines[i].replace(/^[‚Ä¢\-\*\d+\.\)]\s*/, '').trim());
                    } else if (lines[i].match(/^\d+[\.\)]/) || lines[i].match(/^[‚Ä¢\-\*]/)) {
                        directions.push(lines[i].replace(/^\d+[\.\)]\s*/, '').replace(/^[‚Ä¢\-\*]\s*/, '').trim());
                    } else if (ingredients.length === 0 && directions.length === 0) {
                        // If we haven't found ingredients yet, assume it's an ingredient
                        ingredients.push(lines[i]);
                    } else {
                        // Otherwise assume it's a direction
                        directions.push(lines[i]);
                    }
                }
            }
            
            return { title, ingredients, directions };
        }
        
        function importFromText(event) {
            event.preventDefault();
            
            const text = document.getElementById('pastedRecipeText').value.trim();
            if (!text) {
                showToast('Please paste some recipe text');
                return;
            }
            
            const parsed = parseRecipeText(text);
            
            if (!parsed.title) {
                showToast('Could not find recipe title. Please make sure the first line is the recipe name.');
                return;
            }
            
            // Populate the add recipe form with parsed data
            document.getElementById('recipeTitle').value = parsed.title;
            document.getElementById('recipeIngredients').value = parsed.ingredients.join('\n');
            document.getElementById('recipeDirections').value = parsed.directions.join('\n');
            
            // Close import modal and open add recipe modal
            closeImportRecipeModal();
            showAddRecipeModal();
            
            showToast('Recipe parsed! Please review and fill in any missing details.');
        }
        
        async function importFromUrl(event) {
            event.preventDefault();
            
            // Check if we already extracted a recipe and should import it
            const importBtn = document.getElementById('urlImportBtn');
            if (importBtn.getAttribute('data-recipe-extracted') === 'true' && window.extractedRecipeData) {
                importExtractedRecipe(window.extractedRecipeData);
                return;
            }
            
            const url = document.getElementById('recipeUrl').value.trim();
            if (!url) {
                showToast('Please enter a recipe URL');
                return;
            }
            
            // Validate URL
            try {
                new URL(url);
            } catch (e) {
                showToast('Please enter a valid URL');
                return;
            }
            
            const loadingDiv = document.getElementById('urlLoading');
            const previewDiv = document.getElementById('urlPreview');
            
            loadingDiv.style.display = 'block';
            previewDiv.style.display = 'none';
            importBtn.disabled = true;
            importBtn.textContent = 'Extracting...';
            importBtn.setAttribute('data-recipe-extracted', 'false');
            
            try {
                // Use a CORS proxy to fetch the recipe page
                // Note: In production, you'd want to use your own backend or a recipe extraction API
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                const data = await response.json();
                
                if (!data.contents) {
                    throw new Error('Could not fetch recipe page');
                }
                
                // Parse HTML to extract recipe data
                const parser = new DOMParser();
                const doc = parser.parseFromString(data.contents, 'text/html');
                
                // Try to find JSON-LD structured data (Schema.org Recipe)
                let recipeData = null;
                const jsonLdScripts = doc.querySelectorAll('script[type="application/ld+json"]');
                
                for (const script of jsonLdScripts) {
                    try {
                        const json = JSON.parse(script.textContent);
                        if (json['@type'] === 'Recipe' || (Array.isArray(json['@type']) && json['@type'].includes('Recipe'))) {
                            recipeData = json;
                            break;
                        }
                        // Sometimes it's wrapped in @graph
                        if (json['@graph']) {
                            const recipe = json['@graph'].find(item => 
                                item['@type'] === 'Recipe' || 
                                (Array.isArray(item['@type']) && item['@type'].includes('Recipe'))
                            );
                            if (recipe) {
                                recipeData = recipe;
                                break;
                            }
                        }
                    } catch (e) {
                        // Skip invalid JSON
                    }
                }
                
                // If no structured data, try to extract from common HTML patterns
                if (!recipeData) {
                    recipeData = extractRecipeFromHTML(doc, url);
                }
                
                if (!recipeData || !recipeData.name) {
                    throw new Error('Could not extract recipe data from this URL');
                }
                
                // Show preview
                document.getElementById('urlPreviewTitle').textContent = recipeData.name;
                const info = [];
                if (recipeData.recipeIngredient && recipeData.recipeIngredient.length) {
                    info.push(`${recipeData.recipeIngredient.length} ingredients`);
                }
                if (recipeData.recipeInstructions && recipeData.recipeInstructions.length) {
                    info.push(`${recipeData.recipeInstructions.length} steps`);
                }
                document.getElementById('urlPreviewInfo').textContent = info.join(' ‚Ä¢ ') || 'Recipe found';
                
                previewDiv.style.display = 'block';
                
                // Store recipe data for import
                window.extractedRecipeData = recipeData;
                importBtn.disabled = false;
                importBtn.textContent = 'Import Recipe';
                importBtn.setAttribute('data-recipe-extracted', 'true');
                
            } catch (error) {
                console.error('Error extracting recipe:', error);
                showToast(`Error: ${error.message}. Try pasting the recipe text instead.`);
                importBtn.disabled = false;
                importBtn.textContent = 'Extract & Import Recipe';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }
        
        function extractRecipeFromHTML(doc, url) {
            // Fallback extraction from common HTML patterns
            const recipe = {
                name: '',
                recipeIngredient: [],
                recipeInstructions: []
            };
            
            // Try to find title
            recipe.name = doc.querySelector('h1')?.textContent?.trim() || 
                         doc.querySelector('[class*="recipe-title"]')?.textContent?.trim() ||
                         doc.querySelector('[class*="recipe-name"]')?.textContent?.trim() ||
                         '';
            
            // Try to find ingredients
            const ingredientSelectors = [
                '[class*="ingredient"]',
                '[class*="recipe-ingredient"]',
                '[itemprop="recipeIngredient"]',
                'ul.ingredients li',
                'ol.ingredients li'
            ];
            
            for (const selector of ingredientSelectors) {
                const elements = doc.querySelectorAll(selector);
                if (elements.length > 0) {
                    recipe.recipeIngredient = Array.from(elements)
                        .map(el => el.textContent.trim())
                        .filter(text => text && text.length > 2);
                    if (recipe.recipeIngredient.length > 0) break;
                }
            }
            
            // Try to find instructions
            const instructionSelectors = [
                '[class*="instruction"]',
                '[class*="recipe-step"]',
                '[class*="direction"]',
                '[itemprop="recipeInstructions"]',
                'ol.instructions li',
                'ol.directions li'
            ];
            
            for (const selector of instructionSelectors) {
                const elements = doc.querySelectorAll(selector);
                if (elements.length > 0) {
                    recipe.recipeInstructions = Array.from(elements)
                        .map(el => el.textContent.trim())
                        .filter(text => text && text.length > 2);
                    if (recipe.recipeInstructions.length > 0) break;
                }
            }
            
            return recipe.name ? recipe : null;
        }
        
        function importExtractedRecipe(recipeData) {
            // Convert extracted recipe to our format
            const ingredients = Array.isArray(recipeData.recipeIngredient) 
                ? recipeData.recipeIngredient 
                : [];
            
            let directions = [];
            if (Array.isArray(recipeData.recipeInstructions)) {
                directions = recipeData.recipeInstructions.map(inst => {
                    if (typeof inst === 'string') return inst;
                    if (inst.text) return inst.text;
                    if (inst['@type'] === 'HowToStep' && inst.text) return inst.text;
                    return String(inst);
                }).filter(d => d);
            }
            
            // Populate the add recipe form
            document.getElementById('recipeTitle').value = recipeData.name || '';
            document.getElementById('recipeIngredients').value = ingredients.join('\n');
            document.getElementById('recipeDirections').value = directions.join('\n');
            
            // Try to extract additional info
            if (recipeData.totalTime) {
                // Could parse time if needed
            }
            if (recipeData.recipeYield) {
                // Could parse servings if needed
            }
            
            // Close import modal and open add recipe modal
            closeImportRecipeModal();
            showAddRecipeModal();
            
            showToast('Recipe extracted! Please review and fill in any missing details.');
        }
        
        // Load recipes on page load
        loadRecipes();
    </script>
</body>
</html>

